---
title: "Question 3"
author: "Jin Barai"
output: html_document
---
#### (a)

#### (b)
```{r, echo=FALSE}
data <- read.csv("spotify.csv", header = TRUE)
library(kableExtra)
plot_corr <- function(x, y) {
  plot(0, 0,
       main = "",
       xlab = "",
       ylab = "",
       xaxt = "n",
       yaxt = "n",
       col = "white")
  text(x = 0, y = 0,
       labels = paste(round(cor(x, y), 4)),
       col = "firebrick",
       cex = 2)
}

par(mfcol = c(3, 3), mar = c(1, 4, 4, 1))

plot_corr(data$valence, data$bpm)
title(ylab = "bpm", font.lab = 2)
title(main="valence", font=2)
plot_corr(data$valence, data$energy)
title(ylab = "energy", font.lab = 2)
plot_corr(data$valence, data$danceability)
title(ylab = "danceability", font.lab = 2)
plot_corr(data$valence, data$loudness)
title(ylab = "loudness", font.lab = 2)
title(main="valence", font=2)
plot_corr(data$valence, data$liveness)
title(ylab = "liveness", font.lab = 2)
plot_corr(data$valence, data$duration)
title(ylab = "duration", font.lab = 2)
plot_corr(data$valence, data$acousticness)
title(ylab = "acousticness", font.lab = 2)
title(main="valence", font=2)
plot_corr(data$valence, data$speechiness)
title(ylab = "speechiness", font.lab = 2)
plot_corr(data$valence, data$popularity)
title(ylab = "popularity", font.lab = 2)
```

From above, we can clearly observe that **loudness**, **energy** and **danceability** are most strongly correlated with valence. 
\
***Loudness:*** Positive correlation with valence
\
***Energy:*** Positive correlation with valence
\
***Danceability:*** Positive correlation with valence

#### (c)
Top 5 songs with Highest Valence
```{r}
order_valence <- order(data$valence, decreasing=TRUE)
# Table
kable_styling(kable(data[order_valence, ][1:5, c("title", "artist", "year","valence")]))
```

#### (d)
Determining which song has the highest and lowest danceability
```{r}
highest_danceability <- which.max(data$danceability)
lowest_danceability <- which.min(data$danceability)
# Table
kable_styling(kable(data[c(lowest_danceability,highest_danceability), ][c("title","artist","year","danceability")]))
```

#### (e)
```{r}
par(mfcol = c(1,1))
diff <- abs(data$acousticness - mean(data$acousticness))
Delta <- diff/(length(data$acousticness)-1)
plot(Delta, 
     main ="Influence of songs on average acousticness",
     ylab = bquote(Delta),
     pch = 16,
     col = adjustcolor("blue", alpha.f=0.5))
# Maximum influence on acousticness
kable_styling(kable(data[c(which.max(Delta), which.max(data$acousticness)), c("title", "artist", "acousticness")]))
```


#### (f)
```{r}
par(mfcol = c(1,1))
diff <- abs(data$speechiness - mean(data$speechiness))
Delta <- diff/(length(data$speechiness)-1)
plot(Delta, 
     main ="Influence of songs on average speechiness",
     ylab = bquote(Delta),
     pch = 16,
     col = adjustcolor("red", alpha.f=0.5))
# Maximum influence on speechiness
kable_styling(kable(data[c(which.max(Delta), which.max(data$speechiness)), c("title", "artist", "speechiness")]))
```


#### (g)


#### (h)
```{r}
# Artists that have appeared in the Billboard Top 30 Four Times 
top_artists <- names(which(table(data$artist) == 4))
num_appears <- rep(0, length(top_artists))
artist_pop <- rep(0, length(top_artists))
for (i in 1:length(top_artists)) {
  artist_match <- data$artist == top_artists[i]
  song_pop <- data[artist_match, ]$valence
  num_appears[i] <- length(song_pop)
  artist_pop[i] <- round(mean(song_pop))
}

```
